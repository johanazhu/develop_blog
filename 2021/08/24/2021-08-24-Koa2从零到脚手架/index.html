<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="azhubabyçš„æŠ€æœ¯åšå®¢"><title>Koa2ä»é›¶åˆ°è„šæ‰‹æ¶ | Azhubaby Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.1"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','G-QLGQ1V2DVG','auto');ga('send','pageview');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + 'b735438e944e58cd4b0914986a8f821c';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><div class="darkmode-toggle">ğŸŒ“</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 5.4.2"></head><body><header class="clearfix" id="header"><div class="container"><div class="col-group"><div class="site-name"><h1 class="hidden">Koa2ä»é›¶åˆ°è„šæ‰‹æ¶</h1><a id="logo" href="/.">Azhubaby Blog</a><p class="description">å…³äºç¼–ç¨‹ã€ä¸ªäººæˆé•¿ä»¥åŠæ€è€ƒ</p></div><div> <nav class="clearfix" id="nav-menu"><a class="current" href="/."><i class="fa undefined"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa undefined"> å½’æ¡£</i></a><a href="/tags/"><i class="fa undefined"> æ ‡ç­¾</i></a><a href="/about/"><i class="fa undefined"> å…³äº</i></a><a class="search-icon" href="javascript:void(0)"><i class="fa fa-search"></i></a></nav></div></div></div></header><div id="body"><div class="container"><div class="col-group"><div class="col-8" id="main"><div class="res-cons"><div class="post"><h1 class="post-title">Koa2ä»é›¶åˆ°è„šæ‰‹æ¶</h1><div class="post-meta">2021-08-24<span> | </span><span class="category"><a href="/categories/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91/">æœåŠ¡ç«¯å¼€å‘</a><!--busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js--><a href="/categories/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91/Koa2/">Koa2</a><!--busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js--></span><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> é˜…è¯»</span></span><span> | </span><span>ä½œè€…ï¼š</span><span class="author">å¤©é¾™äºº</span></div><div class="post-content"><h2 id="ä»€ä¹ˆæ˜¯-Koa2"><a href="#ä»€ä¹ˆæ˜¯-Koa2" class="headerlink" title="ä»€ä¹ˆæ˜¯ Koa2"></a>ä»€ä¹ˆæ˜¯ Koa2</h2><p>ç”± Express åŸç­äººé©¬æ‰“é€ çš„æ–°ç”Ÿä»£ Node.js Web æ¡†æ¶ï¼Œå®ƒçš„ä»£ç å¾ˆç®€å•ï¼Œæ²¡æœ‰åƒ Express é‚£æ ·ï¼Œæä¾›è·¯ç”±ã€é™æ€æœåŠ¡ç­‰ç­‰ï¼Œå®ƒæ˜¯ä¸ºäº†è§£å†³ Node é—®é¢˜ï¼ˆç®€åŒ–äº† Node ä¸­æ“ä½œï¼‰å¹¶å–ä»£ä¹‹ï¼Œå®ƒæœ¬èº«æ˜¯ä¸€ä¸ªç®€å•çš„ä¸­é—´ä»¶æ¡†æ¶ï¼Œéœ€è¦é…åˆå„ä¸ªä¸­é—´ä»¶æ‰èƒ½ä½¿ç”¨</p>
<p><a target="_blank" rel="noopener" href="https://koajs.com/">æ–‡æ¡£</a></p>
<p><a target="_blank" rel="noopener" href="https://koa.bootcss.com/">ä¸­æ–‡æ–‡æ¡£</a> (é‡ç”Ÿ)</p>
<h2 id="æœ€ç®€å•çš„-Koa-æœåŠ¡å™¨"><a href="#æœ€ç®€å•çš„-Koa-æœåŠ¡å™¨" class="headerlink" title="æœ€ç®€å•çš„ Koa æœåŠ¡å™¨"></a>æœ€ç®€å•çš„ Koa æœåŠ¡å™¨</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Koa</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Koa</span>();</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">ctx</span>) =&gt;</span> &#123;</span><br><span class="line">  ctx.<span class="property">body</span> = <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3000ç«¯å£å·²å¯åŠ¨&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="æ´‹è‘±æ¨¡å‹"><a href="#æ´‹è‘±æ¨¡å‹" class="headerlink" title="æ´‹è‘±æ¨¡å‹"></a>æ´‹è‘±æ¨¡å‹</h2><p><img src="https://i.loli.net/2021/08/22/HBG3YuUs6Pn48AO.png" alt="æ´‹è‘±æ¨¡å‹"></p>
<p>è¿™æ˜¯ Koa çš„æ´‹è‘±æ¨¡å‹</p>
<p>çœ‹çœ‹ Express çš„ä¸­é—´ä»¶æ˜¯ä»€ä¹ˆæ ·çš„ï¼š</p>
<p><img src="https://i.loli.net/2021/08/22/hMleGoU2NwQtYqO.png" alt="Expressçš„ä¸­é—´ä»¶"></p>
<p>è¯·æ±‚ï¼ˆRequestï¼‰ç›´æ¥ä¾æ¬¡è´¯ç©¿å„ä¸ªä¸­é—´ä»¶ï¼Œæœ€åé€šè¿‡è¯·æ±‚å¤„ç†å‡½æ•°è¿”å›å“åº”ï¼ˆResponseï¼‰ã€‚å†æ¥çœ‹çœ‹ Koa çš„ä¸­é—´ä»¶æ˜¯ä»€ä¹ˆæ ·çš„ï¼š</p>
<p><img src="https://i.loli.net/2021/08/22/clE2NI1svCihqQm.png" alt="koaçš„ä¸­é—´ä»¶"></p>
<p>å¯ä»¥çœ‹å‡ºï¼ŒKoa ä¸­é—´ä»¶ä¸åƒ Express ä¸­é—´ä»¶é‚£æ ·åœ¨è¯·æ±‚é€šè¿‡äº†ä¹‹åå°±å®Œæˆè‡ªå·±çš„ä½¿å‘½ï¼›ç›¸åï¼Œä¸­é—´ä»¶çš„æ‰§è¡Œæ¸…æ™°åœ°åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µã€‚æˆ‘ä»¬çœ‹çœ‹ Koa ä¸­é—´ä»¶å…·ä½“æ˜¯ä»€ä¹ˆæ ·çš„</p>
<h2 id="Koa-ä¸­é—´ä»¶çš„å®šä¹‰"><a href="#Koa-ä¸­é—´ä»¶çš„å®šä¹‰" class="headerlink" title="Koa ä¸­é—´ä»¶çš„å®šä¹‰"></a>Koa ä¸­é—´ä»¶çš„å®šä¹‰</h2><p>Koa çš„ä¸­é—´ä»¶æ˜¯è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">middleware</span>(<span class="params">ctx, next</span>) &#123;</span><br><span class="line">  <span class="comment">// å…ˆåšä»€ä¹ˆ</span></span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">  <span class="comment">// ååšä»€ä¹ˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ Koa Contextï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­è´¯ç©¿ä¸­é—´ä»¶å’Œè¯·æ±‚å¤„ç†å‡½æ•°çš„ç»¿è‰²ç®­å¤´æ‰€ä¼ é€’çš„å†…å®¹ï¼Œé‡Œé¢å°è£…äº†è¯·æ±‚ä½“å’Œå“åº”ä½“ï¼ˆå®é™…ä¸Šè¿˜æœ‰å…¶ä»–å±æ€§ï¼‰ï¼Œåˆ†åˆ«å¯ä»¥é€šè¿‡ <code>ctx.request</code> å’Œ <code>ctx.response</code> æ¥è·å–ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„å±æ€§ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="property">url</span>; <span class="comment">// ç›¸å½“äº ctx.request.url</span></span><br><span class="line">ctx.<span class="property">body</span>; <span class="comment">// ç›¸å½“äº ctx.response.boby</span></span><br><span class="line">ctx.<span class="property">status</span>; <span class="comment">// ç›¸å½“äº ctx.response.status</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ›´å¤š Context å±æ€§è¯·å‚è€ƒ <a target="_blank" rel="noopener" href="https://github.com/koajs/koa/blob/master/docs/api/context.md">Context API æ–‡æ¡£</a></p>
</blockquote>
<p>ä¸­é—´ä»¶çš„ç¬¬äºŒä¸ªå‚æ•°ä¾¿æ˜¯ <code>next</code> å‡½æ•°ï¼šç”¨æ¥æŠŠæ§åˆ¶æƒè½¬äº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚ä½†å®ƒä¸ Express çš„ <code>next</code> å‡½æ•°æœ¬è´¨çš„åŒºåˆ«åœ¨äºï¼Œ <strong>Koa çš„ <code>next</code> å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª Promise</strong> ï¼Œåœ¨è¿™ä¸ª Promise è¿›å…¥å®ŒæˆçŠ¶æ€ï¼ˆFulfilledï¼‰åï¼Œå°±ä¼šå»æ‰§è¡Œä¸­é—´ä»¶ä¸­ç¬¬äºŒä¸ªé˜¶æ®µçš„ä»£ç ã€‚</p>
<h2 id="æœ‰å“ªäº›å¸¸è§çš„ä¸­é—´ä»¶"><a href="#æœ‰å“ªäº›å¸¸è§çš„ä¸­é—´ä»¶" class="headerlink" title="æœ‰å“ªäº›å¸¸è§çš„ä¸­é—´ä»¶"></a>æœ‰å“ªäº›å¸¸è§çš„ä¸­é—´ä»¶</h2><h3 id="è·¯ç”±ä¸­é—´ä»¶â€”â€”koa-router-æˆ–-koa-router"><a href="#è·¯ç”±ä¸­é—´ä»¶â€”â€”koa-router-æˆ–-koa-router" class="headerlink" title="è·¯ç”±ä¸­é—´ä»¶â€”â€”koa-router æˆ–@koa/router"></a>è·¯ç”±ä¸­é—´ä»¶â€”â€”koa-router æˆ–@koa/router</h3><h4 id="ä¸‹è½½-npm-åŒ…"><a href="#ä¸‹è½½-npm-åŒ…" class="headerlink" title="ä¸‹è½½ npm åŒ…"></a>ä¸‹è½½ npm åŒ…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install koa-router --save</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æœ‰äº›æ•™ç¨‹ä½¿ç”¨ <code>@koa/router</code>ï¼Œç°å¦‚ä»Šè¿™ä¸¤ä¸ªåº“ç”±åŒä¸€ä¸ªäººç»´æŠ¤ï¼Œä»£ç ä¹Ÿä¸€è‡´ã€‚å³ koa-router === @koa/routerï¼ˆå†™è‡ª 2021 å¹´ 8 æœˆ 23 æ—¥ï¼‰</p>
</blockquote>
<p>NPM åŒ…åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/koa-router">koa-router</a> ã€<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/@koa/router">@koa/router</a></p>
<h4 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h4><p>åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º controllers ç›®å½•ï¼Œç”¨æ¥å­˜æ”¾æ§åˆ¶å™¨æœ‰å…³çš„ä»£ç ã€‚é¦–å…ˆæ˜¯ HomeControllerï¼Œåˆ›å»º controllers/home.jsï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HomeController</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">home</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    ctx.<span class="property">body</span> = <span class="string">&#x27;hello world&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    ctx.<span class="property">body</span> = <span class="string">&#x27;Login Controller&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">register</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    ctx.<span class="property">body</span> = <span class="string">&#x27;Register Controller&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">HomeController</span>;</span><br></pre></td></tr></table></figure>

<h4 id="å®ç°è·¯ç”±"><a href="#å®ç°è·¯ç”±" class="headerlink" title="å®ç°è·¯ç”±"></a>å®ç°è·¯ç”±</h4><p>å†åˆ›å»º routes æ–‡ä»¶å¤¹ï¼Œç”¨äºæŠŠæ§åˆ¶å™¨æŒ‚è½½åˆ°å¯¹åº”çš„è·¯ç”±ä¸Šé¢ï¼Œåˆ›å»º home.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Router</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; home, login, register &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../controllers/home&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, home);</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, login);</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/register&#x27;</span>, register);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<h4 id="æ³¨å†Œè·¯ç”±"><a href="#æ³¨å†Œè·¯ç”±" class="headerlink" title="æ³¨å†Œè·¯ç”±"></a>æ³¨å†Œè·¯ç”±</h4><p>åœ¨ routes ä¸­åˆ›å»º index.jsï¼Œä»¥åæ‰€æœ‰çš„è·¯ç”±éƒ½æ”¾å…¥ routesï¼Œæˆ‘ä»¬åˆ›å»º index.js çš„ç›®çš„æ˜¯ä¸ºäº†è®©ç»“æ„æ›´åŠ æ•´é½ï¼Œindex.js è´Ÿè´£æ‰€æœ‰è·¯ç”±çš„æ³¨å†Œï¼Œå®ƒçš„å…„å¼Ÿæ–‡ä»¶è´Ÿè´£å„è‡ªçš„è·¯ç”±</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">app</span>) =&gt;</span> &#123;</span><br><span class="line">  fs.<span class="title function_">readdirSync</span>(__dirname).<span class="title function_">forEach</span>(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (file === <span class="string">&#x27;index.js&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> route = <span class="built_in">require</span>(<span class="string">`./<span class="subst">$&#123;file&#125;</span>`</span>);</span><br><span class="line">    app.<span class="title function_">use</span>(route.<span class="title function_">routes</span>()).<span class="title function_">use</span>(route.<span class="title function_">allowedMethods</span>());</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨ï¼šallowedMethods çš„ä½œç”¨</p>
<ol>
<li>å“åº” option æ–¹æ³•ï¼Œå‘Šè¯‰å®ƒæ‰€æ”¯æŒçš„è¯·æ±‚æ–¹æ³•</li>
<li>ç›¸åº”åœ°è¿”å› 405 ï¼ˆä¸å…è®¸ï¼‰å’Œ 501 ï¼ˆæ²¡å®ç°ï¼‰</li>
</ol>
<p>æ³¨ï¼šå¯ä»¥çœ‹åˆ° <code>@koa/router</code> çš„ä½¿ç”¨æ–¹å¼åŸºæœ¬ä¸Šä¸ Express Router ä¿æŒä¸€è‡´</p>
</blockquote>
<h4 id="å¼•å…¥è·¯ç”±"><a href="#å¼•å…¥è·¯ç”±" class="headerlink" title="å¼•å…¥è·¯ç”±"></a>å¼•å…¥è·¯ç”±</h4><p>æœ€åæˆ‘ä»¬éœ€è¦å°† router æ³¨å†Œä¸ºä¸­é—´ä»¶ï¼Œæ–°å»º <code>index.js</code>ï¼Œç¼–å†™ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Koa</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> routing = <span class="built_in">require</span>(<span class="string">&#x27;./routes&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ– Koa åº”ç”¨å®ä¾‹</span></span><br><span class="line">consr app = <span class="keyword">new</span> <span class="title class_">Koa</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œä¸­é—´ä»¶</span></span><br><span class="line"><span class="comment">// ç›¸åº”ç”¨æˆ·è¯·æ±‚</span></span><br><span class="line"><span class="title function_">routing</span>(app)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿è¡ŒæœåŠ¡å™¨</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ postman æµ‹è¯•ä¸€ä¸‹</p>
<p><img src="https://i.loli.net/2021/08/24/PFnyfjLORIZ1imC.png" alt="æµ‹è¯•è·¯ç”±"></p>
<h3 id="å…¶ä»–ä¸­é—´ä»¶"><a href="#å…¶ä»–ä¸­é—´ä»¶" class="headerlink" title="å…¶ä»–ä¸­é—´ä»¶"></a>å…¶ä»–ä¸­é—´ä»¶</h3><ul>
<li>koa-bodyparser â€”â€”è¯·æ±‚ä½“è§£æ</li>
<li>koa-static â€”â€” æä¾›é™æ€èµ„æºæœåŠ¡</li>
<li>@koa/cors â€”â€” è·¨åŸŸ</li>
<li>koa-json-error â€”â€” å¤„ç†é”™è¯¯</li>
<li>koa-parameter â€”â€” å‚æ•°æ ¡éªŒ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cnpm i koa-bodyparser -S</span><br><span class="line">cnpm i koa-static -S</span><br><span class="line">cnpm i @koa/cors -S</span><br><span class="line">cnpm i koa-json-error -S</span><br><span class="line">cnpm i koa-parameter -S</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Koa</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bobyParser = <span class="built_in">require</span>(<span class="string">&#x27;koa-bodyparser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> koaStatic = <span class="built_in">require</span>(<span class="string">&#x27;koa-static&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;@koa/cors&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> error = <span class="built_in">require</span>(<span class="string">&#x27;koa-json-error&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> parameter = <span class="built_in">require</span>(<span class="string">&#x27;koa-parameter&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> routing = <span class="built_in">require</span>(<span class="string">&#x27;./routes&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Koa</span>();</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(</span><br><span class="line">  <span class="title function_">error</span>(&#123;</span><br><span class="line">    <span class="attr">postFormat</span>: <span class="function">(<span class="params">e, &#123; stack, ...rest &#125;</span>) =&gt;</span></span><br><span class="line">      process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span> ? rest : &#123; stack, ...rest &#125;,</span><br><span class="line">  &#125;),</span><br><span class="line">);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">bobyParser</span>());</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">koaStatic</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>)));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>());</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">parameter</span>(app));</span><br><span class="line"><span class="title function_">routing</span>(app);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3000ç«¯å£å·²å¯åŠ¨&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="å®ç°-JWT-é‰´æƒ"><a href="#å®ç°-JWT-é‰´æƒ" class="headerlink" title="å®ç° JWT é‰´æƒ"></a>å®ç° JWT é‰´æƒ</h2><p>JSON Web Tokenï¼ˆJWTï¼‰æ˜¯ä¸€ç§æµè¡Œçš„ RESTful API é‰´æƒæ–¹æ¡ˆ</p>
<p>å…ˆå®‰è£…ç›¸å…³çš„ npm åŒ…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install koa-jwt jsonwebtoken -S</span><br></pre></td></tr></table></figure>

<p>åˆ›å»º <code>config/index.js</code> ï¼Œç”¨æ¥å­˜æ”¾ JWT Secret å¸¸é‡ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">JWT_SECRET</span> = <span class="string">&#x27;secret&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="variable constant_">JWT_SECRET</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æœ‰äº›è·¯ç”±æˆ‘ä»¬å¸Œæœ›åªæœ‰å·²ç™»å½•çš„ç”¨æˆ·æ‰æœ‰æƒæŸ¥çœ‹ï¼ˆå—ä¿æŠ¤è·¯ç”±ï¼‰ï¼Œè€Œå¦ä¸€äº›è·¯ç”±åˆ™æ˜¯æ‰€æœ‰è¯·æ±‚éƒ½å¯ä»¥è®¿é—®ï¼ˆä¸å—ä¿æŠ¤çš„è·¯ç”±ï¼‰ã€‚åœ¨ Koa çš„æ´‹è‘±æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°ï¼š</p>
<p><img src="https://i.loli.net/2021/08/23/J5LYKBUTFIm4Q87.png" alt="åŠ å…¥JWTåçš„æ´‹è‘±æ¨¡å‹"></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½å¯ä»¥ç›´æ¥è®¿é—®æœªå—ä¿æŠ¤çš„è·¯ç”±ï¼Œä½†æ˜¯å—ä¿æŠ¤çš„è·¯ç”±éƒ½æ”¾åœ¨ JWT ä¸­é—´ä»¶çš„åé¢ï¼Œæˆ‘ä»¬éœ€è¦å†åˆ›å»ºå‡ ä¸ªæ–‡ä»¶æ¥åš JWT çš„å®éªŒ</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œæ‰€è°“çš„ç”¨æˆ·ï¼ˆusersï¼‰æ˜¯ä¸ªæœ€å¸¸è§çš„éœ€è¦é‰´æƒçš„è·¯ç”±ï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨ controllers ä¸­åˆ›å»º user.js ï¼Œå†™ä¸‹å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">create</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">200</span>;</span><br><span class="line">    ctx.<span class="property">body</span> = <span class="string">&#x27;create&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">find</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">200</span>;</span><br><span class="line">    ctx.<span class="property">body</span> = <span class="string">&#x27;find&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">findById</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">200</span>;</span><br><span class="line">    ctx.<span class="property">body</span> = <span class="string">&#x27;findById&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">update</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">200</span>;</span><br><span class="line">    ctx.<span class="property">body</span> = <span class="string">&#x27;update&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">delete</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">200</span>;</span><br><span class="line">    ctx.<span class="property">body</span> = <span class="string">&#x27;delete&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">UserController</span>;</span><br></pre></td></tr></table></figure>

<h4 id="æ³¨å†Œ-JWT-ä¸­é—´ä»¶"><a href="#æ³¨å†Œ-JWT-ä¸­é—´ä»¶" class="headerlink" title="æ³¨å†Œ JWT ä¸­é—´ä»¶"></a>æ³¨å†Œ JWT ä¸­é—´ä»¶</h4><p>ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥éƒ½å®‰æ’ä¸Šäº†ï¼Œè¯­ä¹‰å¾ˆæ˜æ˜¾äº†ï¼Œå…¶æ¬¡æˆ‘ä»¬åœ¨ routes æ–‡ä»¶ä¸­åˆ›å»º user.jsï¼Œè¿™é‡Œå±•ç¤ºä¸ users è·¯ç”±ç›¸å…³çš„ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Router</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;koa-jwt&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  create,</span><br><span class="line">  find,</span><br><span class="line">  findById,</span><br><span class="line">  update,</span><br><span class="line">  <span class="attr">delete</span>: del,</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;../controllers/user&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">Router</span>(&#123; <span class="attr">prefix</span>: <span class="string">&#x27;/users&#x27;</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="variable constant_">JWT_SECRET</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../config/&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> auth = <span class="title function_">jwt</span>(&#123; <span class="variable constant_">JWT_SECRET</span> &#125;);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, create);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, find);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/:id&#x27;</span>, findById);</span><br><span class="line">router.<span class="title function_">put</span>(<span class="string">&#x27;/:id&#x27;</span>, auth, update);</span><br><span class="line">router.<span class="title function_">delete</span>(<span class="string">&#x27;/:id&#x27;</span>, auth, del);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>ç»¼ä¸Šä»£ç ï¼Œroutes æ–‡ä»¶ä¸‹çš„ home.js éƒ½ä¸éœ€è¦ JWT ä¸­é—´ä»¶çš„ä¿æŠ¤ï¼Œuser.js ä¸­çš„ æ›´æ–°å’Œåˆ é™¤éœ€è¦ JWT çš„ä¿æŠ¤</p>
<p>æµ‹è¯•ä¸€ä¸‹ï¼Œèƒ½çœ‹å‡º JWT å·²ç»èµ·ä½œç”¨äº†</p>
<p><img src="https://i.loli.net/2021/08/24/HEt9xDV8WQUnKcJ.png" alt="æµ‹è¯•JWT"></p>
<p>æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®Œæˆäº†å¯¹ JWT çš„éªŒè¯ï¼Œä½†æ˜¯éªŒè¯çš„å‰ææ˜¯å…ˆç­¾å‘ JWTï¼Œæ€ä¹ˆç­¾å‘ï¼Œä½ ç™»å½•çš„æ—¶å€™æˆ‘ç»™ä½ ä¸€ä¸ªç­¾å¥½åçš„ tokenï¼Œè¦æ›´æ–°/åˆ é™¤æ—¶åœ¨è¯·æ±‚å¤´ä¸­å¸¦ä¸Š tokenï¼Œæˆ‘å°±èƒ½æ ¡éªŒâ€¦</p>
<p>è¿™é‡Œç‰µæ‰¯åˆ°ç™»å½•ï¼Œæˆ‘ä»¬å…ˆæš‚åœä¸€ä¸‹ï¼Œå…ˆè¡¥å……æ•°æ®åº“çš„çŸ¥è¯†ï¼Œè®©é¡¹ç›®æ›´åŠ å®Œæ•´</p>
<h2 id="Mongoose-åŠ å…¥æˆ˜åœº"><a href="#Mongoose-åŠ å…¥æˆ˜åœº" class="headerlink" title="Mongoose åŠ å…¥æˆ˜åœº"></a>Mongoose åŠ å…¥æˆ˜åœº</h2><p>å¦‚æœè¦åšä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ï¼Œæ•°æ®åº“æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œä¸ Node åŒ¹é…çš„è¾ƒå¥½çš„æ˜¯ NoSql æ•°æ®åº“ï¼Œå…¶ä¸­ä»¥ Mongodb ä¸ºä»£è¡¨ï¼Œå½“ç„¶å¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨è¿™ä¸€æ•°æ®åº“ï¼Œéœ€è¦æŒ‰ç…§ç›¸åº”çš„åº“ï¼Œè€Œè¿™ä¸ªåº“å°±æ˜¯ mongoose</p>
<h3 id="ä¸‹è½½-mongoose"><a href="#ä¸‹è½½-mongoose" class="headerlink" title="ä¸‹è½½ mongoose"></a>ä¸‹è½½ mongoose</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm i mongoose -S</span><br></pre></td></tr></table></figure>

<h3 id="è¿æ¥åŠé…ç½®"><a href="#è¿æ¥åŠé…ç½®" class="headerlink" title="è¿æ¥åŠé…ç½®"></a>è¿æ¥åŠé…ç½®</h3><p>åœ¨ <code>config/index.js</code> ä¸­æ·»åŠ  connectionStr å˜é‡ï¼Œä»£è¡¨ mongoose è¿æ¥çš„æ•°æ®åº“åœ°å€</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">JWT_SECRET</span> = <span class="string">&#x27;secret&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> connectionStr = <span class="string">&#x27;mongodb://127.0.0.1:27017/basic&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="variable constant_">JWT_SECRET</span>,</span><br><span class="line">  connectionStr,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»º <code>db/index.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; connectionStr &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../config/&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">connect</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    mongoose.<span class="title function_">connect</span>(connectionStr, &#123;</span><br><span class="line">      <span class="attr">useNewUrlParser</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    mongoose.<span class="property">connection</span>.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    mongoose.<span class="property">connection</span>.<span class="title function_">on</span>(<span class="string">&#x27;open&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Mongooseè¿æ¥æˆåŠŸ&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥ä¸»æ–‡ä»¶ <code>index.js</code>ï¼Œä¿®æ”¹é…ç½®å¹¶å¯åŠ¨</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&#x27;./db/&#x27;</span>)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">db.<span class="title function_">connect</span>()</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨æœåŠ¡ <code>npm run serve</code>ï¼Œå³ <code>nodemon index.js</code>ï¼Œèƒ½çœ‹å‡º mongoose å·²ç»è¿æ¥æˆåŠŸäº†</p>
<p><img src="https://i.loli.net/2021/08/23/LQcboKAC8sZXMFh.png" alt="nodemon"></p>
<h3 id="åˆ›å»ºæ•°æ®æ¨¡å‹å®šä¹‰"><a href="#åˆ›å»ºæ•°æ®æ¨¡å‹å®šä¹‰" class="headerlink" title="åˆ›å»ºæ•°æ®æ¨¡å‹å®šä¹‰"></a>åˆ›å»ºæ•°æ®æ¨¡å‹å®šä¹‰</h3><p>åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º <code>models</code> ç›®å½•ï¼Œç”¨æ¥å­˜æ”¾æ•°æ®æ¨¡å‹å®šä¹‰æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­åˆ›å»º <code>User.js</code>ï¼Œä»£è¡¨ç”¨æˆ·æ¨¡å‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> schema = <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">  <span class="attr">username</span>: &#123; <span class="attr">type</span>: <span class="title class_">String</span> &#125;,</span><br><span class="line">  <span class="attr">password</span>: &#123; <span class="attr">type</span>: <span class="title class_">String</span> &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;User&#x27;</span>, schema);</span><br></pre></td></tr></table></figure>

<p>å…·ä½“å¯ä»¥çœ‹çœ‹ <a target="_blank" rel="noopener" href="https://fe.azhubaby.com/Node/Mongoose.html">Mongoose</a> è¿™ç¯‡æ–‡ç« ï¼Œè¿™é‡Œæˆ‘ä»¬å°±çœ‹è¡Œä¸ºï¼Œä»¥ä¸Šä»£ç è¡¨ç¤ºå»ºç«‹äº†ä¸€ä¸ªæ•°æ®å¯¹è±¡ï¼Œä¾›æ“ä½œå™¨æ¥æ“ä½œæ•°æ®åº“</p>
<h3 id="åœ¨-Controller-ä¸­æ“ä½œæ•°æ®åº“"><a href="#åœ¨-Controller-ä¸­æ“ä½œæ•°æ®åº“" class="headerlink" title="åœ¨ Controller ä¸­æ“ä½œæ•°æ®åº“"></a>åœ¨ Controller ä¸­æ“ä½œæ•°æ®åº“</h3><p>ç„¶åå°±å¯ä»¥åœ¨ Controller ä¸­è¿›è¡Œæ•°æ®çš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚é¦–å…ˆæˆ‘ä»¬æ‰“å¼€ <code>constrollers/user.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">User</span> = <span class="built_in">require</span>(<span class="string">&#x27;../models/User&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">create</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; username, password &#125; = ctx.<span class="property">request</span>.<span class="property">body</span>;</span><br><span class="line">    <span class="keyword">const</span> model = <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">create</span>(&#123; username, password &#125;);</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">200</span>;</span><br><span class="line">    ctx.<span class="property">body</span> = model;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">find</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> model = <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">find</span>();</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">200</span>;</span><br><span class="line">    ctx.<span class="property">body</span> = model;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">findById</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> model = <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">findById</span>(ctx.<span class="property">params</span>.<span class="property">id</span>);</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">200</span>;</span><br><span class="line">    ctx.<span class="property">body</span> = model;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">update</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> model = <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">findByIdAndUpdate</span>(ctx.<span class="property">params</span>.<span class="property">id</span>, ctx.<span class="property">request</span>.<span class="property">body</span>);</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">200</span>;</span><br><span class="line">    ctx.<span class="property">body</span> = model;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">delete</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">findByIdAndDelete</span>(ctx.<span class="property">params</span>.<span class="property">id</span>);</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">204</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">UserController</span>;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç ä¸­ï¼Œ</p>
<ul>
<li>User.create({xxx})ï¼šåœ¨ User è¡¨ä¸­åˆ›å»ºä¸€ä¸ªæ•°æ®</li>
<li>User.find()ï¼šæŸ¥çœ‹æ‰€æœ‰çš„ User è¡¨ä¸­çš„æ•°æ®</li>
<li>User.findById(id)ï¼šæŸ¥çœ‹ User è¡¨ä¸­çš„å…¶ä¸­ä¸€ä¸ª</li>
<li>User.findByIdAndUpdate(id, body)ï¼šæ›´æ–° User è¡¨ä¸­çš„å…¶ä¸­ä¸€ä¸ªæ•°æ®</li>
<li>User.findByIdAndDelete(id)ï¼šåˆ é™¤ User è¡¨ä¸­çš„å…¶ä¸­ä¸€ä¸ªæ•°æ®</li>
</ul>
<p>ä»¥ä¸Šå°±æ˜¯å¯¹æ•°æ®åº“çš„<strong>å¢åˆ æ”¹æŸ¥</strong></p>
<h2 id="åŠ ç›"><a href="#åŠ ç›" class="headerlink" title="åŠ ç›"></a>åŠ ç›</h2><p>è¿™ä¸ªæˆ‘ä»¬éœ€è¦å¯¹å¯†ç è¿›è¡Œä¸€ä¸‹åŠ å¯†ï¼Œæ— å®ƒï¼Œå®‰å…¨ã€‚</p>
<p>è¿›æ•°æ®åº“ä¸€æŸ¥ï¼Œå°±èƒ½çœ‹åˆ°å¯†ç ï¼Œè¿™è¯´æ˜æ•°æ®å¯¹å¼€å‘äººå‘˜æ˜¯å…¬å¼€çš„ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ‹¿ç€ç”¨æˆ·çš„è´¦å·å¯†ç åšä»»ä½•äº‹ï¼Œè¿™æ˜¯ä¸è¢«å…è®¸çš„</p>
<p><img src="https://i.loli.net/2021/08/24/iJZhb8D297e4Tjl.png" alt="æ•°æ®åº“ä¸­çš„ç”¨æˆ·è¡¨"></p>
<h3 id="ä¸‹è½½-npm-åŒ…â€”â€”bcrypt"><a href="#ä¸‹è½½-npm-åŒ…â€”â€”bcrypt" class="headerlink" title="ä¸‹è½½ npm åŒ…â€”â€”bcrypt"></a>ä¸‹è½½ npm åŒ…â€”â€”bcrypt</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm i bcrypt --save</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‰å¾€ <code>models/User.js</code> ä¸­ï¼Œå¯¹å…¶è¿›è¡Œæ”¹é€ </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">const</span> schema = <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">  <span class="attr">username</span>: &#123; <span class="attr">type</span>: <span class="title class_">String</span> &#125;,</span><br><span class="line">  <span class="attr">password</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">select</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">val</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">&#x27;bcrypt&#x27;</span>).<span class="title function_">hashSync</span>(val, <span class="number">10</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ  selectï¼šfalse ä¸å¯è§ï¼Œset(val) å¯¹å€¼è¿›è¡ŒåŠ å¯†ï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹</p>
<p><img src="https://i.loli.net/2021/08/24/JoHQ5XICL2Bh1St.png" alt="åˆ›å»ºæå››"></p>
<p>èƒ½çœ‹åˆ° password è¢«åŠ å¯†äº†ï¼Œå³ä½¿åœ¨æ•°æ®åº“é‡Œï¼Œä¹Ÿçœ‹ä¸å‡ºç”¨æˆ·çš„å¯†ç ï¼Œé‚£ç”¨æˆ·è¾“å…¥çš„å¯†ç éš¾é“è¾“å…¥è¿™ä¹ˆä¸€ä¸²å¯†ç ï¼Œæ˜¾ç„¶ä¸æ˜¯ï¼Œç”¨æˆ·è¦æ˜¯è¾“å…¥çš„è¯ï¼Œæˆ‘ä»¬è¦å¯¹å…¶è¿›è¡ŒéªŒè¯ï¼Œä¾‹å¦‚æˆ‘ä»¬çš„ç™»å½•</p>
<p>æˆ‘ä»¬è¿›å…¥ <code>constrollers/home</code> æ–‡ä»¶ä¸­ï¼Œå¯¹å…¶è¿›è¡Œæ”¹é€ ï¼Œ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HomeController</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; username, password &#125; = ctx.<span class="property">request</span>.<span class="property">body</span></span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">findOne</span>(&#123; username &#125;).<span class="title function_">select</span>(<span class="string">&#x27;+password&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> isValid = <span class="built_in">require</span>(<span class="string">&#x27;bcrypt&#x27;</span>).<span class="title function_">compareSync</span>(password, user.<span class="property">password</span>)</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">200</span></span><br><span class="line">    ctx.<span class="property">body</span> = isValid</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>User.findOne({ username }) èƒ½æŸ¥åˆ°åˆ°æ²¡æœ‰ password çš„æ•°æ®ï¼Œå› ä¸ºæˆ‘ä»¬äººä¸ºçš„æŠŠ select è®¾ä¸º falseï¼Œå¦‚æœè¦çœ‹ï¼ŒåŠ ä¸Š select(â€˜+passwordâ€™) å³å¯</li>
<li>require(â€˜bcryptâ€™).compareSync(password, user.password) å°†ç”¨æˆ·è¾“å…¥çš„æ˜æ–‡å¯†ç å’Œæ•°æ®åº“ä¸­çš„åŠ å¯†å¯†ç è¿›è¡ŒéªŒè¯ï¼Œä¸º true æ˜¯æ­£ç¡®ï¼Œfalse ä¸ºå¯†ç ä¸æ­£ç¡®</li>
</ul>
<p>å›åˆ° JWT</p>
<h2 id="åœ¨-Login-ä¸­ç­¾å‘-JWT-Token"><a href="#åœ¨-Login-ä¸­ç­¾å‘-JWT-Token" class="headerlink" title="åœ¨ Login ä¸­ç­¾å‘ JWT Token"></a>åœ¨ Login ä¸­ç­¾å‘ JWT Token</h2><p>æˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ª API ç«¯å£è®©ç”¨æˆ·å¯ä»¥è·å–åˆ° JWT Tokenï¼Œæœ€åˆé€‚çš„å½“ç„¶æ˜¯ç™»å½•æ¥å£ <code>/login</code> ï¼Œæ‰“å¼€ <code>controllers/home.js</code>ï¼Œåœ¨ <code>login</code> æ§åˆ¶å™¨ä¸­å®ç°ç­¾å‘ JWT Token çš„é€»è¾‘ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">User</span> = <span class="built_in">require</span>(<span class="string">&#x27;../models/User&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="variable constant_">JWT_SECRET</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../config/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HomeController</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; username, password &#125; = ctx.<span class="property">request</span>.<span class="property">body</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.æ ¹æ®ç”¨æˆ·åæ‰¾ç”¨æˆ·</span></span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">findOne</span>(&#123; username &#125;).<span class="title function_">select</span>(<span class="string">&#x27;+password&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      ctx.<span class="property">status</span> = <span class="number">422</span></span><br><span class="line">      ctx.<span class="property">body</span> = &#123; <span class="attr">message</span>: <span class="string">&#x27;ç”¨æˆ·åä¸å­˜åœ¨&#x27;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.æ ¡éªŒå¯†ç </span></span><br><span class="line">    <span class="keyword">const</span> isValid = <span class="built_in">require</span>(<span class="string">&#x27;bcrypt&#x27;</span>).<span class="title function_">compareSync</span>(password, user.<span class="property">password</span>)</span><br><span class="line">    <span class="keyword">if</span> (isValid) &#123;</span><br><span class="line">      <span class="keyword">const</span> token = jwt.<span class="title function_">sign</span>(&#123; <span class="attr">id</span>: user.<span class="property">_id</span> &#125;, <span class="variable constant_">JWT_SECRET</span>)</span><br><span class="line">      ctx.<span class="property">status</span> = <span class="number">200</span></span><br><span class="line">      ctx.<span class="property">body</span> = token</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      ctx.<span class="property">status</span> = <span class="number">401</span></span><br><span class="line">      ctx.<span class="property">body</span> = &#123; <span class="attr">message</span>: <span class="string">&#x27;å¯†ç é”™è¯¯&#x27;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>login</code> ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæ ¹æ®ç”¨æˆ·åï¼ˆè¯·æ±‚ä½“ä¸­çš„ <code>name</code> å­—æ®µï¼‰æŸ¥è¯¢å¯¹åº”çš„ç”¨æˆ·ï¼Œå¦‚æœè¯¥ç”¨æˆ·ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å› 401ï¼›å­˜åœ¨çš„è¯å†é€šè¿‡ <code>(bcrypt&#39;).compareSync</code> æ¥éªŒè¯è¯·æ±‚ä½“ä¸­çš„æ˜æ–‡å¯†ç  <code>password</code> æ˜¯å¦å’Œæ•°æ®åº“ä¸­å­˜å‚¨çš„åŠ å¯†å¯†ç æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™é€šè¿‡ <code>jwt.sign</code> ç­¾å‘ Tokenï¼Œå¦‚æœä¸ä¸€è‡´åˆ™è¿˜æ˜¯è¿”å› 401ã€‚</p>
<h2 id="åœ¨-User-æ§åˆ¶å™¨ä¸­æ·»åŠ è®¿é—®æ§åˆ¶"><a href="#åœ¨-User-æ§åˆ¶å™¨ä¸­æ·»åŠ è®¿é—®æ§åˆ¶" class="headerlink" title="åœ¨ User æ§åˆ¶å™¨ä¸­æ·»åŠ è®¿é—®æ§åˆ¶"></a>åœ¨ User æ§åˆ¶å™¨ä¸­æ·»åŠ è®¿é—®æ§åˆ¶</h2><p>Token çš„ä¸­é—´ä»¶å’Œç­¾å‘éƒ½æå®šä¹‹åï¼Œæœ€åä¸€æ­¥å°±æ˜¯åœ¨åˆé€‚çš„åœ°æ–¹æ ¡éªŒç”¨æˆ·çš„ Tokenï¼Œç¡®è®¤å…¶æ˜¯å¦æœ‰è¶³å¤Ÿçš„æƒé™ã€‚æœ€å…¸å‹çš„åœºæ™¯ä¾¿æ˜¯ï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤ç”¨æˆ·æ—¶ï¼Œæˆ‘ä»¬è¦<strong>ç¡®ä¿æ˜¯ç”¨æˆ·æœ¬äººåœ¨æ“ä½œ</strong>ã€‚æ‰“å¼€ <code>controllers/user.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">User</span> = <span class="built_in">require</span>(<span class="string">&#x27;../models/User&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">update</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> userId = ctx.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">    <span class="keyword">if</span> (userId !== ctx.<span class="property">state</span>.<span class="property">user</span>.<span class="property">id</span>) &#123;</span><br><span class="line">      ctx.<span class="property">status</span> = <span class="number">403</span></span><br><span class="line">      ctx.<span class="property">body</span> = &#123;</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;æ— æƒè¿›è¡Œæ­¤æ“ä½œ&#x27;</span>,</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> model = <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">findByIdAndUpdate</span>(ctx.<span class="property">params</span>.<span class="property">id</span>, ctx.<span class="property">request</span>.<span class="property">body</span>)</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">200</span></span><br><span class="line">    ctx.<span class="property">body</span> = model</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">delete</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> userId = ctx.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (userId !== ctx.<span class="property">state</span>.<span class="property">user</span>.<span class="property">id</span>) &#123;</span><br><span class="line">      ctx.<span class="property">status</span> = <span class="number">403</span></span><br><span class="line">      ctx.<span class="property">body</span> = &#123; <span class="attr">message</span>: <span class="string">&#x27;æ— æƒè¿›è¡Œæ­¤æ“ä½œ&#x27;</span> &#125;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">findByIdAndDelete</span>(ctx.<span class="property">params</span>.<span class="property">id</span>)</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">204</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">UserController</span></span><br></pre></td></tr></table></figure>

<p>æ·»åŠ äº†ä¸€äº›ç”¨æˆ·å¹¶ç™»å½•ï¼Œå°† Token æ·»åŠ åˆ°è¯·æ±‚å¤´ä¸­ï¼Œä½¿ç”¨ DELETE åˆ é™¤ç”¨æˆ·ï¼Œèƒ½çœ‹åˆ° çŠ¶æ€ç å˜æˆ 204ï¼Œåˆ é™¤æˆåŠŸ</p>
<p><img src="https://i.loli.net/2021/08/24/TgPnXmwVZF8vYNQ.png" alt="åˆ é™¤ç”¨æˆ·æ“ä½œ"></p>
<h2 id="æ–­è¨€å¤„ç†"><a href="#æ–­è¨€å¤„ç†" class="headerlink" title="æ–­è¨€å¤„ç†"></a>æ–­è¨€å¤„ç†</h2><p>åœ¨åšç™»å½•æ—¶ã€æ›´æ–°ç”¨æˆ·ä¿¡æ¯ã€åˆ é™¤ç”¨æˆ·æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ if else æ¥åˆ¤æ–­ï¼Œè¿™çœ‹èµ·æ¥å¾ˆè ¢ï¼Œå¦‚æœæˆ‘ä»¬èƒ½ç”¨æ–­è¨€æ¥å¤„ç†ï¼Œä»£ç åœ¨çœ‹ä¸Šå»ä¼šä¼˜é›…å¾ˆå¤šï¼Œè¿™ä¸ªæ—¶å€™ <code>http-assert</code> å°±å‡ºæ¥äº†</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// constrollers/home.js</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">&#x27;http-assert&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HomeController</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; username, password &#125; = ctx.<span class="property">request</span>.<span class="property">body</span></span><br><span class="line">    <span class="comment">// 1.æ ¹æ®ç”¨æˆ·åæ‰¾ç”¨æˆ·</span></span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">findOne</span>(&#123; username &#125;).<span class="title function_">select</span>(<span class="string">&#x27;+password&#x27;</span>)</span><br><span class="line">    <span class="comment">// if (!user) &#123;</span></span><br><span class="line">    <span class="comment">//   ctx.status = 401</span></span><br><span class="line">    <span class="comment">//   ctx.body = &#123; message: &#x27;ç”¨æˆ·åä¸å­˜åœ¨&#x27; &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="title function_">assert</span>(user, <span class="number">422</span>, <span class="string">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>)</span><br><span class="line">    <span class="comment">// 2.æ ¡éªŒå¯†ç </span></span><br><span class="line">    <span class="keyword">const</span> isValid = <span class="built_in">require</span>(<span class="string">&#x27;bcrypt&#x27;</span>).<span class="title function_">compareSync</span>(password, user.<span class="property">password</span>)</span><br><span class="line">    <span class="title function_">assert</span>(isValid, <span class="number">422</span>, <span class="string">&#x27;å¯†ç é”™è¯¯&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> token = jwt.<span class="title function_">sign</span>(&#123; <span class="attr">id</span>: user.<span class="property">_id</span> &#125;, <span class="variable constant_">JWT_SECRET</span>)</span><br><span class="line">    ctx.<span class="property">body</span> = &#123; token &#125;</span><br><span class="line">  &#125;</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒç†ï¼Œå¤„ç† <code>controllers/user</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">update</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> userId = ctx.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">    <span class="title function_">assert</span>(userId === ctx.<span class="property">state</span>.<span class="property">user</span>.<span class="property">id</span>, <span class="number">403</span>, <span class="string">&#x27;æ— æƒè¿›è¡Œæ­¤æ“ä½œ&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> model = <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">findByIdAndUpdate</span>(ctx.<span class="property">params</span>.<span class="property">id</span>, ctx.<span class="property">request</span>.<span class="property">body</span>)</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">200</span></span><br><span class="line">    ctx.<span class="property">body</span> = model</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">delete</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> userId = ctx.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">    <span class="title function_">assert</span>(userId === ctx.<span class="property">state</span>.<span class="property">user</span>.<span class="property">id</span>, <span class="number">403</span>, <span class="string">&#x27;æ— æƒè¿›è¡Œæ­¤æ“ä½œ&#x27;</span>)</span><br><span class="line">    <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">findByIdAndDelete</span>(ctx.<span class="property">params</span>.<span class="property">id</span>)</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">204</span></span><br><span class="line">  &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>ä»£ç çœ‹èµ·æ¥å°±æ˜¯æ•´æ´æ¸…çˆ½</p>
<h2 id="å‚æ•°æ ¡éªŒ"><a href="#å‚æ•°æ ¡éªŒ" class="headerlink" title="å‚æ•°æ ¡éªŒ"></a>å‚æ•°æ ¡éªŒ</h2><p>ä¹‹å‰æˆ‘ä»¬åŠ äº†ä¸€ä¸ªä¸­é—´ä»¶â€”â€”<code>koa-parameter</code>ï¼Œæˆ‘ä»¬å½“åˆåªæ˜¯æ³¨å†Œäº†è¿™ä¸ªä¸­é—´ä»¶ï¼Œä½†æ˜¯æœªä½¿ç”¨ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºç”¨æˆ·æ—¶éœ€è¦åˆ¤æ–­ç”¨æˆ·åå’Œå¯†ç çš„æ•°æ®ç±»å‹ä¸º String ç±»å‹ä¸”å¿…å¡«ï¼Œè¿›å…¥ <code>controllers/user.js</code> æ·»åŠ ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">createUser</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    ctx.<span class="title function_">verifyParams</span>(&#123;</span><br><span class="line">      <span class="attr">username</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">      <span class="attr">password</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> &#123; username, password &#125; = ctx.<span class="property">request</span>.<span class="property">body</span></span><br><span class="line">    <span class="keyword">const</span> model = <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">create</span>(&#123; username, password &#125;)</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">200</span></span><br><span class="line">    ctx.<span class="property">body</span> = model</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Github åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/johanazhu/koa-basic">koa-basic</a></p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a target="_blank" rel="noopener" href="https://tuture.co/2020/05/22/fac8401/">ä¸€æ¯èŒ¶çš„æ—¶é—´ï¼Œä¸Šæ‰‹ Koa2 + MySQL å¼€å‘</a></p>
</div><div class="tags"><a href="/tags/Koa2/"><i class="fa fa-tag"></i>Koa2</a><a href="/tags/%E8%84%9A%E6%89%8B%E6%9E%B6/"><i class="fa fa-tag"></i>è„šæ‰‹æ¶</a><a href="/tags/NodeJS/"><i class="fa fa-tag"></i>NodeJS</a></div><div class="post-nav"><a class="pre" href="/2021/08/27/2021-08-27-Koa2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">ä»æµ…å…¥æ·±äº†è§£Koa2æºç </a><a class="next" href="/2021/08/19/2021-08-19-GitHubActions+GitHubPage/">GitHub Actions + Github Page</a></div><div id="container"></div><link rel="stylesheet" type="text/css" href="//unpkg.com/gitalk/dist/gitalk.css?v=1.0.1"><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=1.0.1"></script><script type="text/javascript" src="//unpkg.com/gitalk/dist/gitalk.min.js?v=1.0.1"></script><script>var gitalk = new Gitalk({
  clientID: 'ff0c33d53db26a5b1424',
  clientSecret: 'd42b8e0556a1f4e20667e0a48c1adb9eca12d6ee',
  repo: 'blog',
  owner: 'johanazhu',
  admin: ['johanazhu'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script></div></div></div><div id="secondary"><div class="widget"><div class="widget-title"><h3> æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·</h3></div><div class="wechatwidget"><a href="#"><img src="https://s2.loli.net/2022/03/25/VqfD2ScLuKzjbR8.jpg"/></a><span>å¾®ä¿¡å·ï¼šjohanbo88</span></div></div><div class="widget"><div class="widget-title"><h3>æœ€è¿‘æ–‡ç« </h3></div><ul class="widget-list"><li class="widget-list-item"><a class="widget-list-link" href="/2023/05/22/2023-05-22-Vite+React+TypeScript%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">Vite + React + TypeScript æœ€ä½³å®è·µï¼ˆ2023ï¼‰</a></li><li class="widget-list-item"><a class="widget-list-link" href="/2023/04/24/2023-04-24-%E5%87%A1%E4%BA%BA%E6%BF%80%E5%8A%B150%E8%A8%80/">å‡¡äººæ¿€åŠ±50è¨€</a></li><li class="widget-list-item"><a class="widget-list-link" href="/2023/03/08/2023-03-08-%E6%88%91%E7%9A%84vscode%E9%85%8D%E7%BD%AE/">æˆ‘çš„ VScode é…ç½®</a></li><li class="widget-list-item"><a class="widget-list-link" href="/2023/03/02/2023-03-02-%E5%B0%9D%E8%AF%95%E7%94%A8WSL2+Ubuntu%E5%BC%80%E5%8F%91/">å°è¯•ç”¨ WSL2 + Ubuntu å¼€å‘</a></li><li class="widget-list-item"><a class="widget-list-link" href="/2023/02/13/2023-02-13-%E5%AE%89%E8%A3%85%20docker%20%E5%90%8E%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8/">å®‰è£… docker åæ— æ³•å¯åŠ¨</a></li></ul></div><div class="widget"><div class="widget-title"><h3> åˆ†ç±»</h3></div><ul class="widget-list"><li class="widget-list-item"><a class="widget-list-link" href="/categories/10X%E7%A8%8B%E5%BA%8F%E5%91%98/">10Xç¨‹åºå‘˜</a><span class="widget-list-count">4</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/HTTP/">HTTP</a><span class="widget-list-count">2</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">å‰ç«¯</a><span class="widget-list-count">1</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</a><span class="widget-list-count">35</span><ul class="widget-list-child"><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/CSS/">CSS</a><span class="widget-list-count">6</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/JavaScript/">JavaScript</a><span class="widget-list-count">9</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/React/">React</a><span class="widget-list-count">12</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/umi/">umi</a><span class="widget-list-count">1</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/%E5%BC%80%E5%8F%91/">å¼€å‘</a><span class="widget-list-count">1</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/%E5%BE%AE%E4%BF%A1/">å¾®ä¿¡</a><span class="widget-list-count">3</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">æ€§èƒ½ä¼˜åŒ–</a><span class="widget-list-count">1</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/%E7%A7%BB%E5%8A%A8%E7%AB%AF/">ç§»åŠ¨ç«¯</a><span class="widget-list-count">2</span></li></ul></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E5%AE%9E%E6%88%98/">å®æˆ˜</a><span class="widget-list-count">5</span><ul class="widget-list-child"><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E5%AE%9E%E6%88%98/%E5%85%AC%E5%8F%B8%E9%A1%B9%E7%9B%AE/">å…¬å¸é¡¹ç›®</a><span class="widget-list-count">3</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E5%AE%9E%E6%88%98/%E7%8B%AC%E7%AB%8B%E9%A1%B9%E7%9B%AE/">ç‹¬ç«‹é¡¹ç›®</a><span class="widget-list-count">2</span></li></ul></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E5%BA%93/">åº“</a><span class="widget-list-count">1</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E5%BC%80%E5%8F%91%E4%BD%93%E9%AA%8C/">å¼€å‘ä½“éªŒ</a><span class="widget-list-count">1</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E6%9C%89%E7%9F%A5%E6%9C%89%E8%A1%8C/">æœ‰çŸ¥æœ‰è¡Œ</a><span class="widget-list-count">8</span><ul class="widget-list-child"><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E6%9C%89%E7%9F%A5%E6%9C%89%E8%A1%8C/%E5%86%99%E4%BD%9C/">å†™ä½œ</a><span class="widget-list-count">1</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E6%9C%89%E7%9F%A5%E6%9C%89%E8%A1%8C/%E5%88%86%E4%BA%AB/">åˆ†äº«</a><span class="widget-list-count">4</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E6%9C%89%E7%9F%A5%E6%9C%89%E8%A1%8C/%E5%AD%A6%E4%B9%A0/">å­¦ä¹ </a><span class="widget-list-count">3</span></li></ul></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91/">æœåŠ¡ç«¯å¼€å‘</a><span class="widget-list-count">9</span><ul class="widget-list-child"><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91/Koa2/">Koa2</a><span class="widget-list-count">3</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91/Node/">Node</a><span class="widget-list-count">2</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91/%E9%83%A8%E7%BD%B2/">éƒ¨ç½²</a><span class="widget-list-count">4</span></li></ul></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E7%90%86%E8%B4%A2/">ç†è´¢</a><span class="widget-list-count">1</span><ul class="widget-list-child"><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E7%90%86%E8%B4%A2/%E5%8A%A0%E5%AF%86%E8%B4%A7%E5%B8%81/">åŠ å¯†è´§å¸</a><span class="widget-list-count">1</span></li></ul></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E7%96%91%E9%9A%BE%E6%9D%82%E7%97%87/">ç–‘éš¾æ‚ç—‡</a><span class="widget-list-count">2</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E7%A2%8E%E7%9A%AE%E6%89%AF%E6%B7%A1/">ç¢çš®æ‰¯æ·¡</a><span class="widget-list-count">2</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">ç¼–ç¨‹è¯­è¨€</a><span class="widget-list-count">8</span><ul class="widget-list-child"><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Git/">Git</a><span class="widget-list-count">3</span></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/JavaScript/">JavaScript</a><span class="widget-list-count">5</span></li></ul></li><li class="widget-list-item"><a class="widget-list-link" href="/categories/%E8%BF%90%E7%BB%B4/">è¿ç»´</a><span class="widget-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><h3> å½’æ¡£</h3></div><ul class="widget-list"><li class="widget-list-item"><a class="widget-list-link" href="/archives/2023/05/">2023å¹´äº”æœˆ</a><span class="widget-list-count">1</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2023/04/">2023å¹´å››æœˆ</a><span class="widget-list-count">1</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2023/03/">2023å¹´ä¸‰æœˆ</a><span class="widget-list-count">2</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2023/02/">2023å¹´äºŒæœˆ</a><span class="widget-list-count">1</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2023/01/">2023å¹´ä¸€æœˆ</a><span class="widget-list-count">1</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2022/12/">2022å¹´åäºŒæœˆ</a><span class="widget-list-count">1</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2022/10/">2022å¹´åæœˆ</a><span class="widget-list-count">1</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2022/09/">2022å¹´ä¹æœˆ</a><span class="widget-list-count">1</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2022/08/">2022å¹´å…«æœˆ</a><span class="widget-list-count">1</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2022/07/">2022å¹´ä¸ƒæœˆ</a><span class="widget-list-count">2</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2022/05/">2022å¹´äº”æœˆ</a><span class="widget-list-count">2</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2022/04/">2022å¹´å››æœˆ</a><span class="widget-list-count">4</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2022/03/">2022å¹´ä¸‰æœˆ</a><span class="widget-list-count">7</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2022/02/">2022å¹´äºŒæœˆ</a><span class="widget-list-count">8</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2022/01/">2022å¹´ä¸€æœˆ</a><span class="widget-list-count">5</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2021/12/">2021å¹´åäºŒæœˆ</a><span class="widget-list-count">8</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2021/11/">2021å¹´åä¸€æœˆ</a><span class="widget-list-count">8</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2021/10/">2021å¹´åæœˆ</a><span class="widget-list-count">5</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2021/09/">2021å¹´ä¹æœˆ</a><span class="widget-list-count">5</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2021/08/">2021å¹´å…«æœˆ</a><span class="widget-list-count">8</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2021/05/">2021å¹´äº”æœˆ</a><span class="widget-list-count">1</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2021/04/">2021å¹´å››æœˆ</a><span class="widget-list-count">2</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2021/02/">2021å¹´äºŒæœˆ</a><span class="widget-list-count">1</span></li><li class="widget-list-item"><a class="widget-list-link" href="/archives/2020/11/">2020å¹´åä¸€æœˆ</a><span class="widget-list-count">3</span></li></ul></div><div class="widget"><div class="widget-title"><h3>å‹æƒ…é“¾æ¥</h3></div><ul></ul><a href="https://azhubaby.com/" title="ä¸ªäººç½‘ç«™" target="_blank">ä¸ªäººç½‘ç«™</a><ul></ul><a href="https://fe.azhubaby.com/" title="äº”å¹´å‰ç«¯ä¸‰å¹´é¢è¯•" target="_blank">äº”å¹´å‰ç«¯ä¸‰å¹´é¢è¯•</a></div></div></div></div></div><footer id="footer"><div class="container"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>Â© 2023 <span>æœ¬ç«™æ€»è®¿é—®é‡ï¼š<span id="busuanzi_value_site_pv"></span>&nbsp;æ¬¡</span>
<span>æ€»è®¿å®¢ï¼š<span id="busuanzi_value_site_uv"></span>äºº</span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo. &nbsp;</a>Theme by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></footer><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.1"><script type="text/javascript" src="/js/search.js?v=1.0.1"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'search-input', 'search-results');
</script><script type="text/javascript" src="/js/copycode.js" successtext="å¤åˆ¶æˆåŠŸ!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.1"></script><div class="search-page"><div class="search-icon-close-container"><span class="search-icon-close"><i class="fa fa-chevron-down"></i></span></div><div class="search-main container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><form></form><input type="text" id="search-input" placeholder="searching..."><div class="mini-post-list" id="search-results"></div></div></div></div></div></body></html>